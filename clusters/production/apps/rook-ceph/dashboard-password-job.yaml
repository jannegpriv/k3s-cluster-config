apiVersion: batch/v1
kind: Job
metadata:
  name: rook-ceph-dashboard-password-setter
  namespace: rook-ceph
spec:
  template:
    spec:
      containers:
      - name: ceph-cmd
        image: quay.io/ceph/ceph:v18.2.2
        command: ["/bin/bash", "-c"]
        args:
        - |
          # Wait for the Ceph MGR to be ready
          until ceph -s; do
            echo "Waiting for Ceph cluster to be ready..."
            sleep 5
          done
          
          # Set the dashboard password
          ceph dashboard ac-user-set-password admin Admin123! --force-password
          
          echo "Dashboard password set successfully"
        env:
        - name: CEPH_ARGS
          value: "--conf=/etc/ceph/ceph.conf --keyring=/etc/ceph/keyring --name=client.admin"
        volumeMounts:
        - name: ceph-conf
          mountPath: /etc/ceph
      volumes:
      - name: ceph-conf
        projected:
          sources:
          - secret:
              name: rook-ceph-mon
      restartPolicy: Never
  backoffLimit: 5
