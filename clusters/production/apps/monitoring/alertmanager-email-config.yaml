apiVersion: monitoring.coreos.com/v1alpha1
kind: AlertmanagerConfig
metadata:
  name: alertmanager-config
  namespace: monitoring
spec:
  receivers:
    - name: email
      emailConfigs:
        - to: jannegpriv@gmail.com
          from: jannegpriv@gmail.com
          smarthost: smtp-relay.brevo.com:587
          authUsername: 85deaf001@smtp-brevo.com
          authPassword:
            name: alertmanager-notification-secret
            key: password
          requireTLS: true
          tlsConfig:
            insecureSkipVerify: false
          sendResolved: true
  route:
    # Group by more fields to combine related alerts
    groupBy: ['alertname', 'severity', 'job']
    # Wait longer before initial notification
    groupWait: 1m
    # Wait longer between notification groups
    groupInterval: 10m
    # Wait longer before repeating
    repeatInterval: 6h
    receiver: email
    routes:
      # Route for warning or critical alerts
      - receiver: email
        matchers:
          - name: severity
            value: "warning|critical"
            regex: true
      # Route for any severity that's not none
      - receiver: email
        matchers:
          - name: severity
            value: "none"
            matchType: notEqual
